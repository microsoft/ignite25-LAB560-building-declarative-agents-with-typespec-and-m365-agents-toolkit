# Exercise 2:  Enhance Agent capabilities

Next, you will enhance the agent by adding more operations in the Repairs API service, enabling responses with Adaptive Cards, and incorporating code interpreter capabilities. Let's explore each of these enhancements step by step.
If you are in the browser, go back to your project in VS Code.

## Step 1: Modify agent to add more operations

- Go to file **actions.tsp** and copy paste below snippet just after `listRepairs` operation to add new operations createRepair, updateRepair and deleteRepair. Here you will also define the `Repair` item data model.

```typespec
/**
   * Create a new repair. 
   * When creating a repair, the `id` field is optional and will be generated by the server.
   * The `date` field should be in ISO 8601 format (e.g., "2023-10-01T12:00:00Z").
   * The `image` field should be a valid URL pointing to the image associated with the repair.
   * @param repair The repair to create.
   */
  @route("/repairs")  
  @post  op createRepair(@body repair: Repair): Repair;

  /**
   * Update an existing repair.
   * The `id` field is required to identify the repair to update.
   * The `date` field should be in ISO 8601 format (e.g., "2023-10-01T12:00:00Z").
   * The `image` field should be a valid URL pointing to the image associated with the repair.
   * @param repair The repair to update.
   */
  @route("/repairs")  
  @patch  op updateRepair(@body repair: Repair): Repair;

  /**
   * Delete a repair.
   * The `id` field is required to identify the repair to delete.
   * @param repair The repair to delete.
   */
  @route("/repairs") 
  @delete  op deleteRepair(@body repair: Repair): Repair;
  
  /**
   * A model representing a repair.
   */
  model Repair {
    /**
     * The unique identifier for the repair.
     */
    id?: string;

    /**
     * The short summary or title of the repair.
     */
    title: string;

    /**
     * The detailed description of the repair.
     */
    description?: string;

    /**
     * The user who is assigned to the repair.
     */
    assignedTo?: string;

    /**
     * The optional date and time when the repair is scheduled or completed.
     */
    @format("date-time")
    date?: string;

    /**
     * The URL of the image associated with the repair.
     */
    @format("uri")
    image?: string;
  }

```


- Next, go back to **main.tsp** file and make sure the new operations are also added as the agent's action. Paste the below snippet after the line `op listRepairs is global.RepairsAPI.listRepairs;` inside the `RepairServiceActions` namespace

```typespec
op createRepair is global.RepairsAPI.createRepair;
op updateRepair is global.RepairsAPI.updateRepair;
op deleteRepair is global.RepairsAPI.deleteRepair;   

```
- Also add a new conversation starter for creating a new repair item just after the first conversation start definintion.

```typespec
@conversationStarter(#{
  title: "Create repair",
  text: "Create a new repair titled \"[TO_REPLACE]\" and assign it to me"
})

```
## Step 2: Add adaptive card to function reference

Next, you will enhance the reference cards or response cards using adaptive cards. Let's create an adaptive card for the repair items. 
- In the project, go to the **adaptiveCards** folder under **appPackage** folder. Create a new file named **repair.json** and paste the provided code snippet. This will define a new adaptive card for the repair object. Ignore the default template card that is already present in this folder.

```json
{
    "$schema": "http://adaptivecards.io/schemas/adaptive-card.json",
    "type": "AdaptiveCard",
    "version": "1.5",
    "body": [
  {
    "type": "Container",
    "$data": "${$root}",
    "items": [
      {
        "type": "TextBlock",
        "text": "Title: ${if(title, title, 'N/A')}",
        "weight": "Bolder",
        "wrap": true
      },
      {
        "type": "TextBlock",
        "text": "Description: ${if(description, description, 'N/A')}",
        "wrap": true
      },
      {
        "type": "TextBlock",
        "text": "Assigned To: ${if(assignedTo, assignedTo, 'N/A')}",
        "wrap": true
      },
      {
        "type": "TextBlock",
        "text": "Date: ${if(date, date, 'N/A')}",
        "wrap": true
      },
      {
        "type": "Image",
        "url": "${image}",
        "$when": "${image != null}"
      }
    ]
  }
],  
    "actions": [
      {
        "type": "Action.OpenUrl",
        "title": "View Image",
        "url": "https://www.howmuchisit.org/wp-content/uploads/2011/01/oil-change.jpg"
      }
    ]
  }
  

```

- Next, go back to **actions.tsp** file and locate the listRepairs operation. Just above the operation definition `@get  op listRepairs(@query assignedTo?: string): string;`, paste the card definition using below snippet.

```typespec

  @card( #{ dataPath: "$",  title: "$.title",   url: "$.image", file: "adaptiveCards/repair.json"}) 
  
  ```
The above card response will be sent by the agent when you ask about a repair item or when agent brings a list of items as its reference.

> To keep things simple for this lab, you'll reuse the same card. In practice, you could create separate cards for different operations based on your needs.
 
Continue to add card response for the `createRepair` operation to show what the agent created after the POST operation. 

- Copy paste below snippet just above the code `@post  op createRepair(@body repair: Repair): Repair;`

```typespec

   @card( #{ dataPath: "$",  title: "$.title",   url: "$.image", file: "adaptiveCards/repair.json"}) 

```


## Step 3:  Provision and Test the Agent's

Let's take the updated agent who is also now a repairs analyst to test. 

- Select the agents toolkit's extension icon to open its activity bar from within your project.
- In the activity bar of the toolkit under "LifeCycle" select "Provision" to package and upload the newly updated agent for testing. 
- Next, go back to the open Microsoft Edge browser tab and do a refresh or simply go to  +++https://m365.cloud.microsoft/chat+++ . 
- Select the **RepairServiceAgent** from the left side of the screen under **Agents**.

- Start by using the conversation starter 'Create repair'. Replace parts of the prompt to add a title, then send it to the chat to initiate the interaction. For e.g.

    `Create a new repair titled "360 camera issue" and assign it to me.`

- The confirmation dialog if you notice has more metadata that what you sent, thanks to the new instructions. 

<img width="1089" height="846" alt="confirm" src="https://github.com/user-attachments/assets/34532abb-923d-434b-ae8e-260554a0209e" />

 
 - Proceed to add the item by confirming the dialog.

 The agent responds is with created item shown in a rich adaptive card.

<img width="1113" height="860" alt="success" src="https://github.com/user-attachments/assets/0e598c98-1899-42da-ae7b-c5d7e0082d78" />



 - Next, recheck reference cards work. Send below prompt in the conversation

     `List all my repairs.`

The agent with the list with each referenced with an adaptive card.

<img width="1110" height="640" alt="myissues" src="https://github.com/user-attachments/assets/6bb24a6c-e567-4961-83af-66cc6d899a1d" />


☑️ You've successfully completed the second exercise which is enhacing your agent with more repair operations! Select **Next >** to go a bonus exercise. 
